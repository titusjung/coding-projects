package connect4;

import java.io.*;
import java.util.Arrays;
import java.util.Scanner;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.lang.*;

public class ConnectFour {

	public static void main(String [] args)
	{
		Connect4 game = new Connect4();
		
		Scanner input = new Scanner(System.in);
		String filename;
		FileReader fl;
		while(true)
		{
			System.out.print("Enter file Name: ");
			filename = input.nextLine();
			try{
				System.out.print(filename+ "\n");
				fl = new FileReader(filename);
				break;
			}
			catch(FileNotFoundException fnfe)
			{
				System.out.println("FileNotFoundException: " + fnfe.getMessage());
			}
		}
		game.readGame(fl);
		
		System.out.print(game.toString());
		
		input.close();
		/*
		System.out.print(game.toString());
		game.drop('A');
		game.drop('B');
		game.drop('a');
		System.out.print(game.toString());
		*/
	}
}

class Connect4
{
	private final int bsize = 6;
	private char [] [] Board = new char[bsize][bsize];
	private int turn;
	private final Pattern xpattern =  Pattern.compile(".*X{4}.*");
	private final Pattern opattern = Pattern.compile(".*O{4}.*");
	private Matcher matcher; 
	public Connect4()
	{
		turn =0;
		for(char[] row:Board)
		{
			Arrays.fill(row, 'N');
		}
	}
	
	public String readGame(FileReader fl)
	{
		String result = "No Winner";
		Scanner sc = new Scanner(fl);
		while(sc.hasNext())
		{
			this.drop(sc.next().charAt(0));
			if(this.checkGame()) break;
		}				
		if(checkGame())
		{
			String p1 = "2";
			if(p1turn())
			{
				p1 = "1";
			}
			result = "Player "+ p1 + "has won at turn " + turn;
		}
		return result;		
	}
	
	private Boolean checkWin()
	{
		return false;
	}
	
	public Boolean p1turn()
	{
		return turn%2==0;
	}
	public Boolean checkGame()
	{
		return checkHor();
	}
	private Boolean checkHor()
	{

		StringBuilder sb = new StringBuilder();

		for(char[] row:Board)
		{
			sb.append(row);
			if(checkLine(sb.toString()))
			{
				return true;
			}
			sb.setLength(0);
		}
		return false;
	}
	private Boolean checkLine(String line)
	{
		Pattern p1;
		if(p1turn())
		{
			p1 = xpattern;
		}
		else p1 = opattern;
		matcher= p1.matcher(line);
		return matcher.matches();
	}
	public String toString()
	{
		StringBuilder sb = new StringBuilder();
		for(char[] row:Board)
		{
			sb.append(row);
			sb.append("\n");
		}
		return sb.toString();
	}
	
	public void drop(char col)
	{
		char player;
		char x = Character.toUpperCase(col);
		Character.isLowerCase(col);
		if(turn%2==0)
		{
			player = 'X';
		}
		else
		{
			player = 'O';
		}
		drophelper(x-'A',player);
		turn++;

	}
	private void drophelper(int col, char let)
	{
		if(col>=bsize) return;
		for(int i=bsize-1; i>=0; i--)
		{
			if(Board[i][col]=='N')
			{
				Board[i][col]=let;
				return;
			}
		}
	}
	
}